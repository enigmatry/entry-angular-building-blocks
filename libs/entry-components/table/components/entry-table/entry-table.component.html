<!-- Table content -->
<table mat-table [class.mat-table-hover]="rowHover()" [class.mat-table-striped]="rowStriped()"
  [class.mat-table-with-data]="!hasNoResult()" [dataSource]="dataSource" matSort [matSortActive]="sortActive()!"
  [matSortDirection]="sortDirection()!" [matSortDisableClear]="sortDisableClear()" [matSortDisabled]="sortDisabled()"
  [matSortStart]="sortStart()" (matSortChange)="sortChange.emit($event)">

  <!-- Selection column -->
  @if(rowSelectable())
  {
  <th mat-header-cell *matHeaderCellDef class="selection-cell" aria-label="Select rows"
    [matColumnDef]="selectionColumn">
    @if(multiSelectable() && showSelectAllCheckbox())
    {
    <mat-checkbox aria-label="Select all" [checked]="rowSelection().hasValue() && allRowsSelected()"
      [indeterminate]="rowSelection().hasValue() && !allRowsSelected()"
      (change)="$event ? toggleSelectAllCheckbox() : null">
    </mat-checkbox>
    }
  </th>
  <td mat-cell *matCellDef="let row; let index = index; let dataIndex = dataIndex;" class="selection-cell"
    (click)="$event.stopPropagation()">
    @if(multiSelectable() && !(rowSelectionFormatter().hideCheckbox && rowSelectionFormatter().hideCheckbox!(row)))
    {
    <mat-checkbox aria-label="Select row"
      [disabled]="rowSelectionFormatter().disabled && rowSelectionFormatter().disabled!(row)"
      [checked]="rowSelection().isSelected(row)" (change)="$event ? toggleRowSelection(row) : null">
    </mat-checkbox>
    }

    @if(!multiSelectable() && !(rowSelectionFormatter().hideCheckbox && rowSelectionFormatter().hideCheckbox!(row)))
    {
    <mat-radio-button aria-label="Select row"
      [disabled]="rowSelectionFormatter().disabled && rowSelectionFormatter().disabled!(row)"
      [checked]="rowSelection().isSelected(row)" [value]="rowSelection().isSelected(row)"
      (change)="$event ? toggleRowSelection(row) : null">
    </mat-radio-button>
    }
  </td>
  }

  <!-- Context menu column -->
  @if(showContextMenu())
  {
  <th mat-header-cell *matHeaderCellDef class="action-cell" aria-label="Context Menu Actions"
    [matColumnDef]="contextMenuColumn"></th>
  <td mat-cell *matCellDef="let row; let index = index; let dataIndex = dataIndex;" class="action-cell">
    @if(isTemplateRef(contextMenuTemplate()))
    {
    <ng-template [ngTemplateOutlet]="contextMenuTemplate()"
      [ngTemplateOutletContext]="{ $implicit: row, rowData: row }">
    </ng-template>
    }
    @else{
    <entry-cell-context-menu [items]="contextMenuItems()" [rowData]="row" [rowMenuFormatter]="rowContextMenuFormatter()"
      (selected)="contextMenuItemSelected.emit({itemId: $event, rowData: row})"></entry-cell-context-menu>
    }
  </td>
  }

  @for(column of columns(); track column.field)
  {
  <th mat-header-cell *matHeaderCellDef [class]="getColumnClassList(column)" [matColumnDef]="column.field"
    [class.mat-table-sticky-left]="column.pinned === 'left'" [class.mat-table-sticky-right]="column.pinned === 'right'"
    [sticky]="column.pinned==='left'" [stickyEnd]="column.pinned==='right'"
    [style]="{'width': column.width, 'min-width': column.width}">
    @if(isTemplateRef(headerTemplate()))
    {
    <ng-template [ngTemplateOutlet]="unknownTemplateAsTemplate(headerTemplate())"
      [ngTemplateOutletContext]="{ $implicit: column, colDef: column }">
    </ng-template>
    }
    @else if(headerTemplate() && isTemplateRef(toTemplateIndex(unknownTemplateAsTemplate(headerTemplate()),
    column.field))) {
    <ng-template [ngTemplateOutlet]="toTemplateIndex(unknownTemplateAsTemplate(headerTemplate()), column.field)"
      [ngTemplateOutletContext]="{ $implicit: column, colDef: column }">
    </ng-template>
    }
    @else {
    <div [mat-sort-header]="column.sortProperties?.id || column.field" [disabled]="!column.sortable"
      [disableClear]="column.sortProperties?.disableClear">
      <span>{{column.header}}</span>
    </div>
    }
  </th>

  <td mat-cell *matCellDef="let row; let index = index; let dataIndex = dataIndex;" [class]="getColumnClassList(column)"
    [class.mat-table-sticky-left]="column.pinned === 'left'" [class.mat-table-sticky-right]="column.pinned === 'right'"
    [style]="{'width': column.width, 'min-width': column.width}">
    @if(isTemplateRef(cellTemplate()))
    {
    <ng-template [ngTemplateOutlet]="unknownTemplateAsTemplate(cellTemplate())"
      [ngTemplateOutletContext]="{ $implicit: row, rowData: row, index: getIndex(index, dataIndex), colDef: column }">
    </ng-template>
    }
    @else if(cellTemplate() && isTemplateRef(toTemplateIndex(unknownTemplateAsTemplate(cellTemplate()), column.field)))
    {
    <ng-template [ngTemplateOutlet]="toTemplateIndex(unknownTemplateAsTemplate(cellTemplate()), column.field)"
      [ngTemplateOutletContext]="{ $implicit: row, rowData: row, index: getIndex(index, dataIndex), colDef: column }">
    </ng-template>
    }
    @else if(column.cellTemplate) {
    <ng-template [ngTemplateOutlet]="column.cellTemplate"
      [ngTemplateOutletContext]="{ $implicit: row, rowData: row, index: getIndex(index, dataIndex), colDef: column }">
    </ng-template>
    }
    @else {
    <entry-cell [rowData]="row" [columnDefinition]="column"></entry-cell>
    }
  </td>
  }

  <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
  <tr mat-row *matRowDef="let row; let index = index; let dataIndex = dataIndex; columns: displayedColumns;"
    [class]="getRowClassList(row, getIndex(index, dataIndex))" [attr.tabindex]="rowFocusVisible() ? 0 : -1"
    (click)="rowClick.emit(row)" (keydown.enter)="rowClick.emit(row)">
  </tr>
</table>

<!-- No results -->
@if(hasNoResult())
{
<div class="no-results mat-body-2">
  @if(isTemplateRef(noResultTemplate()))
  {
  <ng-template [ngTemplateOutlet]="noResultTemplate()"></ng-template>
  }
  @else {
  {{noResultText()}}
  }
</div>
}
<!-- Pagination -->
@if(isTemplateRef(paginationTemplate()))
{
<ng-template [ngTemplateOutlet]="paginationTemplate()"></ng-template>
}
@else if(shouldShowPaginator()) {
<mat-paginator class="pagination" [showFirstLastButtons]="showFirstLastButtons()" [length]="total()"
  [pageIndex]="pageIndex()" [pageSize]="pageSize()" [pageSizeOptions]="pageSizeOptions()"
  [hidePageSize]="hidePageSize()" (page)="handlePage($event)" [disabled]="pageDisabled()">
</mat-paginator>
}