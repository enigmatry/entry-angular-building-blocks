trigger:
- master

# no PR triggers
pr: none

pool:
  vmImage: ubuntu-latest

  # This determines the build number
name: $(MajorMinorVersion)$(Rev:.r)

steps:
- task: Npm@1
  displayName: 'Set the version for entry table'
  inputs:
    command: custom
    customCommand: version $(Build.Buildnumber) --no-git-tag-version
    workingDir: 'libs/entry-table'

- task: Npm@1
  displayName: 'Set the version for entry form'
  inputs:
    command: custom
    customCommand: version $(Build.Buildnumber) --no-git-tag-version
    workingDir: 'libs/entry-form'

- task: Npm@1
  displayName: 'Set the version for entry components'
  inputs:
    command: custom
    customCommand: version $(Build.Buildnumber) --no-git-tag-version
    workingDir: 'libs/entry-components'

- task: Npm@1
  displayName: 'Set the version eslint recommended rules'
  inputs:
    command: custom
    customCommand: version $(Build.Buildnumber) --no-git-tag-version
    workingDir: 'libs/eslint-config'
    
- task: Npm@1
  displayName: 'Set the version stylelint recommended rules'
  inputs:
    command: custom
    customCommand: version $(Build.Buildnumber) --no-git-tag-version
    workingDir: 'libs/stylelint-config'

- task: Npm@1
  displayName: 'Set the version scss foundation'
  inputs:
    command: custom
    customCommand: version $(Build.Buildnumber) --no-git-tag-version
    workingDir: 'libs/scss-foundation'

- task: Npm@1
  displayName: 'Set the version scss entry'
  inputs:
    command: custom
    customCommand: version $(Build.Buildnumber) --no-git-tag-version
    workingDir: 'libs/scss-entry'

- task: Npm@1
  displayName: 'npm install'
  inputs:
    command: 'install'

- task: Npm@1
  displayName: 'Lint entry table'
  inputs:
    command: 'custom'
    customCommand: 'run lint @enigmatry/entry-table'

- task: Npm@1
  displayName: 'Lint entry form'
  inputs:
    command: 'custom'
    customCommand: 'run lint @enigmatry/entry-form'

- task: Npm@1
  displayName: 'Lint entry components'
  inputs:
    command: 'custom'
    customCommand: 'run lint @enigmatry/entry-components'

- task: Npm@1
  displayName: 'npm install scss foundation'
  inputs:
    command: 'install'
    workingDir: 'libs/scss-foundation'

- task: Npm@1
  displayName: 'npm install scss entry'
  inputs:
    command: 'install'
    workingDir: 'libs/scss-entry'

- task: Npm@1
  displayName: 'Lint the scss foundation library'
  inputs:
    command: 'custom'
    customCommand: 'run lint'
    workingDir: 'libs/scss-foundation'

- task: Npm@1
  displayName: 'Lint the scss entry library'
  inputs:
    command: 'custom'
    customCommand: 'run lint'
    workingDir: 'libs/scss-entry'
    
- task: Npm@1
  displayName: 'Test the scss foundation library'
  inputs:
    command: 'custom'
    customCommand: 'run test'
    workingDir: 'libs/scss-foundation'

- task: Npm@1
  displayName: 'Build entry table'
  inputs:
    command: 'custom'
    customCommand: 'run build @enigmatry/entry-table'

- task: Npm@1
  displayName: 'Build entry form'
  inputs:
    command: 'custom'
    customCommand: 'run build @enigmatry/entry-form'

- task: Npm@1
  displayName: 'Build entry components'
  inputs:
    command: 'custom'
    customCommand: 'run build @enigmatry/entry-components'

- task: Npm@1
  displayName: 'Build the scss foundation library'
  inputs:
    command: 'custom'
    customCommand: 'run build'
    workingDir: 'libs/scss-foundation'

- task: Npm@1
  displayName: 'Build the scss entry library'
  inputs:
    command: 'custom'
    customCommand: 'run build'
    workingDir: 'libs/scss-entry'

- task: Npm@1
  displayName: 'Publish entry table'
  inputs:
    command: publish
    publishRegistry: useExternalRegistry
    publishEndpoint: npm
    workingDir: 'dist/enigmatry/entry-table'

- task: Npm@1
  displayName: 'Publish entry form'
  inputs:
    command: publish
    publishRegistry: useExternalRegistry
    publishEndpoint: npm
    workingDir: 'dist/enigmatry/entry-form'

- task: Npm@1
  displayName: 'Publish entry components'
  inputs:
    command: publish
    publishRegistry: useExternalRegistry
    publishEndpoint: npm
    workingDir: 'dist/enigmatry/entry-components'

- task: Npm@1
  displayName: 'Publish the eslint recommended rules'
  inputs:
    command: publish
    publishRegistry: useExternalRegistry
    publishEndpoint: npm
    workingDir: 'libs/eslint-config'

- task: Npm@1
  displayName: 'Publish the stylelint recommended rules'
  inputs:
    command: publish
    publishRegistry: useExternalRegistry
    publishEndpoint: npm
    workingDir: 'libs/stylelint-config'
    
- task: Npm@1
  displayName: 'Publish the scss foundation'
  inputs:
    command: publish
    publishRegistry: useExternalRegistry
    publishEndpoint: npm
    workingDir: 'libs/scss-foundation'

- task: Npm@1
  displayName: 'Publish the scss entry'
  inputs:
    command: publish
    publishRegistry: useExternalRegistry
    publishEndpoint: npm
    workingDir: 'libs/scss-entry'
